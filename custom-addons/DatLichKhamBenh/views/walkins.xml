<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--===== Phiếu khám bệnh =====  -->
    <!--Walkins form view-->
    <record id="medical_walkins_view_form" model="ir.ui.view">
        <field name="name">medical.walkins.form</field>
        <field name="model">medical.walkins</field>
        <field name="arch" type="xml">
            <form string="Phiếu khám bệnh">
                <header>
                    <button name="btn_checking" string="Kiểm tra" type="object" class="oe_highlight"/>
                    <button name="btn_waiting_for_invoice" string="Tạo hoá đơn &amp; Thanh toán" type="object" confirm='Bạn có muốn tạo hoá đơn khám bệnh?' class="oe_highlight"/>
                    <button name="btn_completed" string="Đánh dấu là đã hoàn thành" type="object" confirm='Bạn có chắc chắn muốn đánh dấu việc thăm khám đã hoàn thành không?' class="oe_highlight"/>

                    <field name="state" widget="statusbar" />
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" required="1" />
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="patient_id" readonly="id != False"/>
                            <field name="schedule_selection_id" context="{'order_display': 'schedule desc' }" required="[('doctor_id','!=',False)]" readonly="state != 'scheduled'"/>
                        </group>
                        <group>
                            <field name="doctor_id" options="{'no_create': True}" required="[('department_id','!=',False), ('health_center_id', '!=', False)]" help="Vui lòng chọn Trung tâm ý tế và department trước khi chọn bác sĩ"/>
                            <field name="shift_id" invisible="1"/>
                            <field name="schedule_time_domain" invisible="1" />
                            <field name="schedule_time_id" widget="selection_badge" readonly="schedule_selection_id == False or state != 'scheduled'" domain="schedule_time_domain"/>
                            <field name="schedule_date" string="Ngày giờ khám bệnh" readonly="True" />
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="dob" />
                            <field name="marital_status" />
                            <field name="rh" />
                            <field name="reason_check" />
                            <field name="symptom" />
                        </group>
                        <group>
                            <field name="sex" />
                            <field name="blood_type" />
                            <field name="health_center_id"  options="{'no_create': True}"/>
                            <field name="department_id" required="[('health_center_id', '!=', False)]" options="{'no_create': True}"/>
                            <field name="clinic_id" />
                        </group>
                    </group>
                    <notebook>
                        <page string="Điều trị" invisible="state in ['scheduled','waiting_for_check']">
                            <group>
                                <group>
                                    <field name="comments"/>
                                </group>
                                <group>
                                    <field name="diagnosis" readonly="state == 'completed'"/>
                                    <field name="date_re_exam" readonly="state == 'completed'"/>
                                </group>
                            </group>
                            <field name="prescription_ids" context="{'default_walkins_id': active_id}"/>
                        </page>
                        <page string="Chẩn đoán hình ảnh">
                            <div class="o_row">
                                <field name="diagnostic_imaging_ids" context="{'default_walkins_id': active_id}"/>
                            </div>
                        </page>
                        <page string="Vắc xin">
                            <div class="o_row">
                                <field name="vaccine_ids"/>
                            </div>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    <!-- Walkins search view  -->
    <record id="walkins_search_view" model="ir.ui.view">
        <field name="name">Phiếu khám bệnh</field>
        <field name="model">medical.walkins</field>
        <field name="arch" type="xml">
            <search string="">
                <separator />
                <field name="name" select="1"/>
                <field name="patient_id" string="Bệnh nhân" select="1"/>
                <field name="doctor_id" string="Bác sĩ" select="1"/>
                <filter string="Chờ khám" name="state_cho_kham_filter" domain="[('state', '=', 'waiting_for_check')]"/>
                <group expand="0" string="Nhóm theo">
                    <filter string="Khoa" name="group_by_department" context="{'group_by':'department_id'}" />
                    <filter string="Bệnh nhân" name="group_by_name" context="{'group_by': 'patient_id'}" />
                    <filter string="Bác sĩ" name="group_by_doctor" context="{'group_by': 'doctor_id'}"/>
                    <filter string="Giới tính" name="group_by_sex" context="{'group_by': 'sex'}"/>
                    <filter string="Nhóm máu" name="group_by_blood_type" context="{'group_by': 'blood_type'}"/>
                    <filter string="Tình trạng hôn nhân" name="group_by_marital_status" context="{'group_by': 'marital_status'}"/>
                    <filter string="Trạng thái" name="group_by_state" context="{'group_by': 'state'}"/>
                    <filter string="Ngày khám bệnh" name="group_by_schdule_date" context="{'group_by': 'schedule_selection_id'}"/>
                </group>
            </search>
        </field>
    </record>
    <!-- Walkins kanban view-->
    <record id="medical_walkins_kanban_view" model="ir.ui.view">
        <field name="name">medical.walkins.kanban</field>
        <field name="model">medical.walkins</field>
        <field name="arch" type="xml">
            <kanban>
                <field name="image" />
                <field name="patient_id" />
                <field name="name" />
                <field name="schedule_selection_id" />
                <field name="age" />
                <field name="schedule_time_id" />
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click oe_kanban_card">
                            <div class="oeh_medical_vignette oe_semantic_html_override">
                                <div class="o_kanban_image" style="margin-top:15px;">
                                    <a type="open">
                                        <img widget="image" heigh="100" width="100" t-att-alt="record.id.value" t-att-src="kanban_image('medical.walkins', 'image', record.id.raw_value)" />
                                    </a>
                                </div>
                                <div class="oe_kanban_details" style="text-align: left">
                                    <h4>
                                        <a type="open">
                                            <field name="patient_id" />
                                        </a>
                                    </h4>
                                    <ul>
                                        <li>Đợi #: <field name="name"/>
                                        </li>
                                        <li>Giới tính: <field name="sex"/>
                                        </li>
                                        <li>Tuổi: <field name="age"/>
                                        </li>
                                        <li>Ngày: <field name="schedule_selection_id"/>
                                        </li>
                                        <li>Thời gian (24 giờ): <field name="schedule_time_id" />
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    <!--   Walkins tree view-->
    <record id="medical_walkins_tree_view" model="ir.ui.view">
        <field name="name">medical.walkins.tree</field>
        <field name="model">medical.walkins</field>
        <field name="arch" type="xml">
            <tree string="Thông tin phiếu khám bệnh">
                <field name="name" />
                <field name="patient_id" />
                <field name="doctor_id" />
                <field name="schedule_selection_id" />
                <field name="sex" />
                <field name="dob" />
                <field name="blood_type" />
                <field name="rh" />
                <field name="state" />
            </tree>
        </field>
    </record>
    <record id="view_walkins_calendar" model="ir.ui.view">
        <field name="name">medical.walkins.calendar</field>
        <field name="model">medical.walkins</field>
        <field eval="2" name="priority"/>
        <field name="arch" type="xml">
            <calendar string="Phiếu khám bệnh" date_start="schedule_date" color="state" mode="week">
                <field name="doctor_id" />
                <field name="patient_id"/>
                <field name="state"/>
            </calendar>
        </field>
     </record>
    <!-- Walkins action-->
    <record id="medical_walkins_action" model="ir.actions.act_window">
        <field name="name">Phiếu khám bệnh</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">medical.walkins</field>
        <field name="view_mode">kanban,tree,calendar,form</field>
        <field name="context">{'search_default_group_by_doctor': 1, 'search_default_group_by_state': 2}</field>
    </record>

    <record id="morden_action_medical_walkins" model="ir.actions.act_window">
        <field name="name">Danh sách phiếu khám bệnh</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">medical.walkins</field>
        <field name="view_mode">kanban,tree,calendar,form</field>
        <field name="domain">[('doctor_id', '=', active_id)]</field>
        <field name="context">{'search_default_group_by_state': 1, 'search_default_doctor_id': active_id}</field>
    </record>
    <!--===== Prescription =====  -->
    <!-- Prescription form view-->
    <record id="medical_prescription_view_form" model="ir.ui.view">
        <field name="name">medical.prescription.form</field>
        <field name="model">medical.prescription</field>
        <field name="arch" type="xml">
            <form string="Đơn thuốc">
                <header>
                    <button name="btn_send" confirm="Bạn có chắc chắn muốn gửi đơn thuốc đến hiệu thuốc đã chọn không?" string="Gửi đến nhà thuốc" type="object" class="oe_highlight"/>
                    <field name="state" widget="statusbar" />
                </header>
                <sheet>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" required="1" />
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="patient_id" />
                            <field name="pharmacies_id" readonly='id != False'/>
                            <field name="department_id" />
                            <field name="health_center_id" />
                        </group>
                        <group>
                            <field name="doctor_id" />
                            <field name="prescription_date" readonly='id != False'/>
                            <field name="walkins_id" />
                        </group>
                    </group>
                    <notebook>
                        <page string="Chi tiết toa thuốc">
                            <div class="o_row">
                                <field name="prescription_details_ids" context="{'default_prescription_id': active_id}"></field>
                            </div>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    <!-- Prescription search view  -->
    <record id="prescription_search_view" model="ir.ui.view">
        <field name="name">Đơn thuốc</field>
        <field name="model">medical.prescription</field>
        <field name="arch" type="xml">
            <search string="">
                <separator />
                <group expand="0" string="Nhóm theo">
                    <filter string="Bác sĩ" name="group_by_doctor" context="{'group_by': 'doctor_id'}"/>
                    <filter string="Trạng thái" name="group_by_state" context="{'group_by': 'state'}"/>
                </group>
            </search>
        </field>
    </record>
    <!--   Prescription tree view-->
    <record id="medical_prescription_tree_view" model="ir.ui.view">
        <field name="name">medical.prescription.tree</field>
        <field name="model">medical.prescription</field>
        <field name="arch" type="xml">
            <tree string="Thông tin đơn thuốc">
                <field name="name" />
                <field name="patient_id" />
                <field name="prescription_date" />
                <field name="doctor_id" />
                <field name="pharmacies_id" />
                <field name="walkins_id" />
                <field name="state" />
                <button name="action_confirm_and_print" string="In" type="object"/>
            </tree>
        </field>
    </record>
    <!-- Prescription action-->
    <record id="medical_prescription_action" model="ir.actions.act_window">
        <field name="name">Đơn thuốc</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">medical.prescription</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('doctor_id', '=', active_id)]</field>
        <!-- <field name="context">{'search_default_group_by_doctor': 1}</field> -->
    </record>
    <record id="medical_prescription_list_action" model="ir.actions.act_window">
        <field name="name">Danh sách đơn thuốc</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">medical.prescription</field>
        <field name="view_mode">tree,form</field>
    </record>

    <!--===== Prescription details =====  -->
    <!-- Prescription details form view-->
    <record id="medical_prescription_details_view_form" model="ir.ui.view">
        <field name="name">medical.prescription_details.form</field>
        <field name="model">medical.prescription_details</field>
        <field name="arch" type="xml">
            <form string="Chi tiết toa thuốc">
                <sheet>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" required="1" />
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="prescription_id" />
                            <field name="indication" />
                            <field name="comment"/>
                        </group>
                        <group>
                            <field name="medicines_dosage_id" />
                            <field name="dose_units_id"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    <!--   Prescription details tree view-->
    <record id="medical_prescription_details_tree_view" model="ir.ui.view">
        <field name="name">medical.prescription_details.tree</field>
        <field name="model">medical.prescription_details</field>
        <field name="arch" type="xml">
            <tree string="Chi tiết toa thuốc">
                <field name="name" />
                <field name="indication" />
                <field name="medicines_dosage_id" />
                <field name="dose_units_id" />
                <field name="comment" />
            </tree>
        </field>
    </record>
    <!-- <record id="medical_prescription_details_action" model="ir.actions.act_window">
        <field name="name">Chi tiết toa thuốc</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">medical.prescription_details</field>
        <field name="view_mode">tree,form</field>
    </record> -->
</odoo>